name: Inshepct

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  doc:
    runs-on: ubuntu-22.04

    steps:
      - name: Install tools
        run: |
          set -x
          sudo apt-get update
          sudo apt-get install -y fd-find ripgrep
          wget -q https://github.com/tomwright/dasel/releases/download/v2.0.0/dasel-linux-amd64 -O /tmp/dasel
          sudo mv /tmp/dasel /usr/local/bin/dasel
          sudo chmod +x /usr/local/bin/dasel
          pushd /tmp
          curl --output inshpect \
            --location https://raw.githubusercontent.com/msimberg/inshpect/f7b6045cdf832da30be1b0fb88a35827cc443ffa/inshpect
          sha256sum inshpect
          echo "04b6160cc0b1a45a38db319617697a0bb6a0c1413313d945a4ba73811dd5288a inshpect" | sha256sum --check
          chmod +x inshpect
          mv inshpect /usr/local/bin
          popd
      - name: Checkout
        uses: actions/checkout@v4
      - name: Inshpect
        if: always()
        run: |
          export INSHPECT_NUMTHREADS=4
          export INSHPECT_FD=fdfind
          inshpect . .inshpect.toml
