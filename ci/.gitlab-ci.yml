include:
  - local: 'ci/cpu/clang12_release.yml'
  - local: 'ci/cpu/gcc11_debug.yml'
  - local: 'ci/cpu/gcc11_release.yml'
  - local: 'ci/cpu/gcc11_release_stdexec.yml'
  - local: 'ci/cpu/gcc11_debug_stdexec.yml'
  - local: 'ci/cpu/gcc12_release_cxx20.yml'
  - local: 'ci/cpu/clang13_release_cxx20.yml'

#cpu release build gcc12 cxx20:
#cpu release build clang13 cxx20:

#cuda release build gcc11:
#  extends: .build_spack_common
#  variables:
#    BUILD_DOCKER_FILE: ci/docker/build.Dockerfile
#    DEPLOY_DOCKER_FILE: ci/docker/deploy.Dockerfile
#    BASE_IMAGE: docker.io/nvidia/cuda:11.7.1-devel-ubuntu22.04
#    DEPLOY_BASE_IMAGE: docker.io/ubuntu:22.04
#    EXTRA_APTGET: ""
#    EXTRA_APTGET_DEPLOY: "glibc-tools"
#    # glibc-tools is needed for libSegFault on ubuntu:22.04
#    COMPILER: gcc@11.2.0
#    CXXSTD: 17
#    USE_MKL: "ON"
#    USE_ROCBLAS: "OFF"
#    SPACK_ENVIRONMENT: ci/docker/release-cuda.yaml
#    COMMON_SPACK_ENVIRONMENT: ci/docker/common.yaml
#    BUILD_IMAGE: $CSCS_REGISTRY_PATH/release-cuda-gcc11/build
#    DEPLOY_IMAGE: $CSCS_REGISTRY_PATH/release-cuda-gcc11/deploy:$CI_COMMIT_SHA
#    SLURM_CONSTRAINT: gpu
#    THREADS_PER_NODE: 24
#    USE_CODECOV: "false"
#
#cuda release build gcc11 scalapack:
#  extends: .build_spack_common
#  variables:
#    BUILD_DOCKER_FILE: ci/docker/build.Dockerfile
#    DEPLOY_DOCKER_FILE: ci/docker/deploy.Dockerfile
#    BASE_IMAGE: docker.io/nvidia/cuda:11.7.1-devel-ubuntu22.04
#    DEPLOY_BASE_IMAGE: docker.io/ubuntu:22.04
#    EXTRA_APTGET: ""
#    EXTRA_APTGET_DEPLOY: "glibc-tools"
#    # glibc-tools is needed for libSegFault on ubuntu:22.04
#    COMPILER: gcc@11.2.0
#    CXXSTD: 17
#    USE_MKL: "ON"
#    USE_ROCBLAS: "OFF"
#    SPACK_ENVIRONMENT: ci/docker/release-cuda-scalapack.yaml
#    COMMON_SPACK_ENVIRONMENT: ci/docker/common.yaml
#    BUILD_IMAGE: $CSCS_REGISTRY_PATH/release-cuda-gcc11-scalapack/build
#    DEPLOY_IMAGE: $CSCS_REGISTRY_PATH/release-cuda-gcc11-scalapack/deploy:$CI_COMMIT_SHA
#    SLURM_CONSTRAINT: gpu
#    THREADS_PER_NODE: 24
#    USE_CODECOV: "false"
#
#cuda codecov build gcc11:
#  extends: .build_spack_common
#  variables:
#    BUILD_DOCKER_FILE: ci/docker/build.Dockerfile
#    DEPLOY_DOCKER_FILE: ci/docker/codecov.Dockerfile
#    BASE_IMAGE: docker.io/nvidia/cuda:11.7.1-devel-ubuntu22.04
#    DEPLOY_BASE_IMAGE: docker.io/ubuntu:22.04
#    EXTRA_APTGET: ""
#    EXTRA_APTGET_DEPLOY: "glibc-tools"
#    # glibc-tools is needed for libSegFault on ubuntu:22.04
#    COMPILER: gcc@11.2.0
#    CXXSTD: 17
#    USE_MKL: "OFF"
#    USE_ROCBLAS: "OFF"
#    SPACK_ENVIRONMENT: ci/docker/debug-cuda.yaml
#    COMMON_SPACK_ENVIRONMENT: ci/docker/common.yaml
#    BUILD_IMAGE: $CSCS_REGISTRY_PATH/codecov-cuda-gcc11/build
#    DEPLOY_IMAGE: $CSCS_REGISTRY_PATH/codecov-cuda-gcc11/deploy:$CI_COMMIT_SHA
#    SLURM_CONSTRAINT: gpu
#    THREADS_PER_NODE: 24
#    USE_CODECOV: "true"
#
# TODO codecov -> debug
#cuda codecov build gcc11 scalapack:
#  extends: .build_spack_common
#  variables:
#    BUILD_DOCKER_FILE: ci/docker/build.Dockerfile
#    DEPLOY_DOCKER_FILE: ci/docker/deploy.Dockerfile
#    BASE_IMAGE: docker.io/nvidia/cuda:11.7.1-devel-ubuntu22.04
#    DEPLOY_BASE_IMAGE: docker.io/ubuntu:22.04
#    EXTRA_APTGET: ""
#    EXTRA_APTGET_DEPLOY: "glibc-tools"
#    # glibc-tools is needed for libSegFault on ubuntu:22.04
#    COMPILER: gcc@11.2.0
#    CXXSTD: 17
#    USE_MKL: "OFF"
#    USE_ROCBLAS: "OFF"
#    SPACK_ENVIRONMENT: ci/docker/debug-cuda-scalapack.yaml
#    COMMON_SPACK_ENVIRONMENT: ci/docker/common.yaml
#    BUILD_IMAGE: $CSCS_REGISTRY_PATH/codecov-cuda-gcc11/build
#    DEPLOY_IMAGE: $CSCS_REGISTRY_PATH/codecov-cuda-gcc11/deploy:$CI_COMMIT_SHA
#    SLURM_CONSTRAINT: gpu
#    THREADS_PER_NODE: 24
#    USE_CODECOV: "false"
#

#questa sotto non ha la parte di test nel file .yml, avr√† solo il blocco deps e build

#rocm release build clang14+rocm-5.3.3:
#  extends: .build_spack_common
#  variables:
#    BUILD_DOCKER_FILE: ci/docker/build.Dockerfile
#    DEPLOY_DOCKER_FILE: ci/docker/deploy.Dockerfile
#    BASE_IMAGE: $CSCS_REGISTRY_PATH/rocm-patched:5.3.3
#    DEPLOY_BASE_IMAGE: $CSCS_REGISTRY_PATH/rocm-patched:5.3.3
#    EXTRA_APTGET: "clang-14 libomp-14-dev rocblas rocblas-dev rocsolver rocsolver-dev rocprim-dev rocthrust-dev llvm-amdgpu rocm-device-libs"
#    EXTRA_APTGET_DEPLOY: "glibc-tools"
#    # glibc-tools is needed for libSegFault on ubuntu:22.04
#    COMPILER: clang@14.0.0
#    CXXSTD: 17
#    USE_MKL: "OFF"
#    USE_ROCBLAS: "ON"
#    SPACK_ENVIRONMENT: ci/docker/release-rocm533.yaml
#    COMMON_SPACK_ENVIRONMENT: ci/docker/common.yaml
#    BUILD_IMAGE: $CSCS_REGISTRY_PATH/release-rocm-clang14/build
#    DEPLOY_IMAGE: $CSCS_REGISTRY_PATH/release-rocm-clang14/deploy:$CI_COMMIT_SHA
#    SLURM_CONSTRAINT: mc
#    THREADS_PER_NODE: 64
#    USE_CODECOV: "false"


##
## RUNS
##

#cpu release test gcc11 stdexec:
#  extends: .run_common
#  needs:
#    - cpu release build gcc11 stdexec
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cpu release build gcc11 stdexec
#
#
#cpu release test gcc12 cxx20:
#  extends: .run_common
#  needs:
#    - cpu release build gcc12 cxx20
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cpu release build gcc12 cxx20
#
#cpu release test clang13 cxx20:
#  extends: .run_common
#  needs:
#    - cpu release build clang13 cxx20
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cpu release build clang13 cxx20
#
#cuda release test gcc11:
#  extends: .run_common
#  needs:
#    - cuda release build gcc11
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cuda release build gcc11
#
#cuda release test gcc11 scalapack:
#  extends: .run_common
#  needs:
#    - cuda release build gcc11 scalapack
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cuda release build gcc11 scalapack
#
#cuda codecov test gcc11:
#  extends: .run_common
#  needs:
#    - cuda codecov build gcc11
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cuda codecov build gcc11
#
#cuda codecov test gcc11 scalapack:
#  extends: .run_common
#  needs:
#    - cuda codecov build gcc11 scalapack
#  trigger:
#    include:
#      - artifact: pipeline.yml
#        job: cuda codecov build gcc11 scalapack
